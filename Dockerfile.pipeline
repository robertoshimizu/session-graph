FROM python:3.12-slim

WORKDIR /app

# Install system deps for rdflib and pika
RUN apt-get update && apt-get install -y --no-install-recommends gcc && rm -rf /var/lib/apt/lists/*

# Install Python deps
COPY requirements.txt requirements-gemini.txt ./
RUN pip install --no-cache-dir -r requirements-gemini.txt pika>=1.3.0

# Copy application code
COPY pipeline/ pipeline/
COPY ontology/ ontology/
COPY docker/ docker/

CMD ["python", "-m", "docker.queue_consumer"]
